{"version":3,"sources":["../../source/server/index.js"],"names":[],"mappings":";;AAAA;;AACA;;AACA;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,MAAM,MAAM,iBAAO,GAAP,CAAW,KAAX,CAAZ;;AAEA,MAAM,MAAM,oBAAZ;;AAEA,yBAAU,GAAV;;;AAGA,IAAI,GAAJ,CAAQ,WAAW,IAAX,EAAiB;AACvB,OAAK,QAAL,GAAgB,QAAQ,IAAR,CAAa,KAAK,GAAlB,IAAyB,IAAzB,GAAgC,IAAhD;AACA,OAAK,GAAL,GAAW,GAAX;AACA,QAAM,IAAN;AACD,CAJD;;AAMA,IAAI,GAAJ,CAAQ,uBAAQ,GAAR,EAAa;AACnB,WAAQ,CAAC,IAAD,EAAO,OAAP,CADW;AAEnB,aAAW,gBAAK,SAAL,EAAgB,eAAhB,CAFQ;AAGnB,SAAO,CACL,OADK,E;AAEL,cAAY;AACV,WAAO,KAAK,QAAL,KAAkB,IAAlB,GAAyB,OAAzB,GAAmC,IAA1C;AACD,GAJI;AAHY,CAAb,CAAR;;AAWA,IAAI,GAAJ,CAAQ,wBAAS,gBAAK,SAAL,EAAgB,gBAAhB,CAAT,EAA4C;AAClD,aAAW;AADuC,CAA5C,CAAR;;AAIA,IAAI,GAAJ,CAAQ,WAAW,IAAX,EAAiB;;AAEvB,QAAM,IAAI,KAAK,QAAf;AACA,QAAM,OAAO,KAAK,IAAlB;;AAEA,QAAM,cAAc,CAClB,EAAE,MAAM,CAAC,CAAD,GAAI,CAAJ,EAAM,QAAN,CAAR,EAAyB,MAAM,KAAK,EAAL,CAAQ,SAAR,CAA/B,EADkB,EAElB,EAAE,MAAM,CAAC,CAAD,GAAI,CAAJ,EAAM,SAAN,CAAR,EAA0B,MAAM,KAAK,EAAL,CAAQ,UAAR,CAAhC,EAFkB,EAGlB,EAAE,MAAM,CAAC,CAAD,GAAI,CAAJ,EAAM,YAAN,CAAR,EAA6B,MAAM,KAAK,EAAL,CAAQ,aAAR,CAAnC,EAHkB,EAIlB,EAAE,MAAM,CAAC,CAAD,GAAI,CAAJ,EAAM,MAAN,CAAR,EAAuB,MAAM,KAAK,EAAL,CAAQ,OAAR,CAA7B,EAJkB,EAKlB,EAAE,MAAM,CAAC,CAAD,GAAI,CAAJ,EAAM,IAAN,CAAR,EAAqB,MAAM,KAAK,EAAL,CAAQ,KAAR,CAA3B,EALkB,EAMlB,EAAE,MAAM,CAAC,CAAD,GAAI,CAAJ,EAAM,WAAN,CAAR,EAA4B,MAAM,KAAK,EAAL,CAAQ,YAAR,CAAlC,EANkB,EAOlB,EAAE,MAAM,CAAC,CAAD,GAAI,CAAJ,EAAM,QAAN,CAAR,EAAyB,MAAM,KAAK,EAAL,CAAQ,SAAR,CAA/B,EAPkB,CAApB;;AAUA,OAAK,KAAL,GAAa;AACX,UAAM,KAAK,IADA;AAEX,cAAU,KAAK,QAFJ;AAGX,4BAHW;AAIX;AAJW,GAAb;;AAOA,QAAM,IAAN;AACD,CAvBD;;AAyBA,IAAI,GAAJ,CAAQ,WAAW,IAAX,EAAiB;AACvB,MAAI;AACF,UAAM,IAAN;AACD,GAFD,CAEE,OAAO,GAAP,EAAY;AACZ,YAAQ,KAAR,CAAc,IAAI,KAAlB;AACA,SAAK,MAAL,GAAc,GAAd;AACD;AACF,CAPD;;AASA,IAAI,GAAJ,CAAQ,8BAAR;AACA,IAAI,GAAJ,CAAQ,yBAAU,gBAAK,SAAL,EAAgB,cAAhB,CAAV,CAAR;AACA,IAAI,GAAJ,CAAQ,yBAAU,gBAAK,SAAL,EAAgB,qBAAhB,CAAV,CAAR;;AAEA,IAAI,GAAJ;;AAEA,IAAI,MAAJ,CAAW,QAAQ,GAAR,CAAY,IAAZ,IAAoB,KAA/B,EAAsC,MAAM,QAAQ,GAAR,CAAY,iBAAZ,CAA5C","file":"index.js","sourcesContent":["import 'source-map-support/register';\nimport './config';\nimport { join } from 'path';\nimport config from 'config';\nimport koa from 'koa';\nimport koaViews from 'koa-views';\nimport koaStatic from 'koa-static';\nimport koaLocale from 'koa-locale';\nimport koai18n from 'koa-i18n';\nimport koaBodyparser from 'koa-bodyparser';\nimport routes from './routes';\n\nconst CDN = config.get('CDN');\n\nconst app = koa();\n\nkoaLocale(app);\n\n// Provide convenience for links in template\napp.use(function *(next) {\n  this.basePath = /\\/cn/i.test(this.url) ? 'cn' : 'en';\n  this.CDN = CDN;\n  yield next;\n});\n\napp.use(koai18n(app, {\n  locales:['en', 'zh-CN'],\n  directory: join(__dirname, '../../locales'),\n  modes: [\n    'query', // ?locale=zh-CN\n    function () {\n      return this.basePath === 'cn' ? 'zh-CN' : 'en';\n    },\n  ],\n}));\n\napp.use(koaViews(join(__dirname, '../../template'), {\n  extension: 'ejs'\n}));\n\napp.use(function *(next) {\n\n  const b = this.basePath;\n  const i18n = this.i18n;\n\n  const navigations = [\n    { href: `/${b}/faculty`, text: i18n.__('Faculty') },\n    { href: `/${b}/activity`, text: i18n.__('Activity') },\n    { href: `/${b}/competition`, text: i18n.__('Competition') },\n    { href: `/${b}/apply`, text: i18n.__('Apply') },\n    { href: `/${b}/cim`, text: i18n.__('CIM') },\n    { href: `/${b}/regulation`, text: i18n.__('Regulation') },\n    { href: `/${b}/contact`, text: i18n.__('Contact') },\n  ];\n\n  this.state = {\n    i18n: this.i18n,\n    basePath: this.basePath,\n    navigations,\n    CDN,\n  };\n\n  yield next;\n});\n\napp.use(function *(next) {\n  try {\n    yield next;\n  } catch (err) {\n    console.error(err.stack);\n    this.status = 500;\n  }\n});\n\napp.use(koaBodyparser());\napp.use(koaStatic(join(__dirname, '../../public')));\napp.use(koaStatic(join(__dirname, '../../source/client')));\n\napp.use(routes);\n\napp.listen(process.env.PORT || 10000, () => console.log('listen on 10000'));\n"]}