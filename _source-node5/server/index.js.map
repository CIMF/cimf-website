{"version":3,"sources":["../../source/server/index.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;AAYA,MAAM,MAAM,iBAAO,GAAP,CAAW,KAAX,CAAN;;AAEN,MAAM,MAAM,oBAAN;;AAEN,yBAAU,GAAV;;;AAGA,IAAI,GAAJ,CAAQ,WAAW,IAAX,EAAiB;AACvB,OAAK,QAAL,GAAgB,QAAQ,IAAR,CAAa,KAAK,GAAL,CAAb,GAAyB,IAAzB,GAAgC,IAAhC,CADO;AAEvB,OAAK,GAAL,GAAW,GAAX,CAFuB;AAGvB,QAAM,IAAN,CAHuB;CAAjB,CAAR;;AAMA,IAAI,GAAJ,CAAQ,uBAAQ,GAAR,EAAa;AACnB,WAAQ,CAAC,IAAD,EAAO,OAAP,CAAR;AACA,aAAW,gBAAK,SAAL,EAAgB,eAAhB,CAAX;AACA,SAAO,CACL,OADK;AAEL,cAAY;AACV,WAAO,KAAK,QAAL,KAAkB,IAAlB,GAAyB,OAAzB,GAAmC,IAAnC,CADG;GAAZ,CAFF;CAHM,CAAR;;AAWA,IAAI,GAAJ,CAAQ,wBAAS,gBAAK,SAAL,EAAgB,gBAAhB,CAAT,EAA4C;AAClD,aAAW,KAAX;CADM,CAAR;;AAIA,IAAI,GAAJ,CAAQ,WAAW,IAAX,EAAiB;;AAEvB,QAAM,IAAI,KAAK,QAAL,CAFa;AAGvB,QAAM,OAAO,KAAK,IAAL,CAHU;;AAKvB,QAAM,cAAc,CAClB,EAAE,MAAM,CAAC,CAAD,GAAI,CAAJ,EAAM,QAAN,CAAN,EAAuB,MAAM,KAAK,EAAL,CAAQ,SAAR,CAAN,EADP,EAElB,EAAE,MAAM,CAAC,CAAD,GAAI,CAAJ,EAAM,SAAN,CAAN,EAAwB,MAAM,KAAK,EAAL,CAAQ,UAAR,CAAN,EAFR,EAGlB,EAAE,MAAM,CAAC,CAAD,GAAI,CAAJ,EAAM,YAAN,CAAN,EAA2B,MAAM,KAAK,EAAL,CAAQ,aAAR,CAAN,EAHX,EAIlB,EAAE,MAAM,CAAC,CAAD,GAAI,CAAJ,EAAM,MAAN,CAAN,EAAqB,MAAM,KAAK,EAAL,CAAQ,OAAR,CAAN,EAJL,EAKlB,EAAE,MAAM,CAAC,CAAD,GAAI,CAAJ,EAAM,IAAN,CAAN,EAAmB,MAAM,KAAK,EAAL,CAAQ,KAAR,CAAN,EALH,EAMlB,EAAE,MAAM,CAAC,CAAD,GAAI,CAAJ,EAAM,WAAN,CAAN,EAA0B,MAAM,KAAK,EAAL,CAAQ,YAAR,CAAN,EANV,EAOlB,EAAE,MAAM,CAAC,CAAD,GAAI,CAAJ,EAAM,QAAN,CAAN,EAAuB,MAAM,KAAK,EAAL,CAAQ,SAAR,CAAN,EAPP,CAAd,CALiB;;AAevB,OAAK,KAAL,GAAa;AACX,UAAM,KAAK,IAAL;AACN,cAAU,KAAK,QAAL;AACV,eAHW;AAIX,OAJW;GAAb,CAfuB;;AAsBvB,QAAM,IAAN,CAtBuB;CAAjB,CAAR;;AAyBA,IAAI,GAAJ,CAAQ,WAAW,IAAX,EAAiB;AACvB,MAAI;AACF,UAAM,IAAN,CADE;GAAJ,CAEE,OAAO,GAAP,EAAY;AACZ,YAAQ,KAAR,CAAc,IAAI,KAAJ,CAAd,CADY;AAEZ,SAAK,MAAL,GAAc,GAAd,CAFY;GAAZ;CAHI,CAAR;;AASA,IAAI,GAAJ,CAAQ,8BAAR;AACA,IAAI,GAAJ,CAAQ,yBAAU,gBAAK,SAAL,EAAgB,cAAhB,CAAV,CAAR;AACA,IAAI,GAAJ,CAAQ,yBAAU,gBAAK,SAAL,EAAgB,qBAAhB,CAAV,CAAR;;AAEA,IAAI,GAAJ;;AAEA,IAAI,MAAJ,CAAW,QAAQ,GAAR,CAAY,IAAZ,IAAoB,KAApB,EAA2B,MAAM,QAAQ,GAAR,CAAY,iBAAZ,CAAN,CAAtC","file":"index.js","sourcesContent":["import 'source-map-support/register';\nimport './config';\nimport { join } from 'path';\nimport config from 'config';\nimport koa from 'koa';\nimport koaViews from 'koa-views';\nimport koaStatic from 'koa-static';\nimport koaLocale from 'koa-locale';\nimport koai18n from 'koa-i18n';\nimport koaBodyparser from 'koa-bodyparser';\nimport routes from './routes';\n\nconst CDN = config.get('CDN');\n\nconst app = koa();\n\nkoaLocale(app);\n\n// Provide convenience for links in template\napp.use(function *(next) {\n  this.basePath = /\\/cn/i.test(this.url) ? 'cn' : 'en';\n  this.CDN = CDN;\n  yield next;\n});\n\napp.use(koai18n(app, {\n  locales:['en', 'zh-CN'],\n  directory: join(__dirname, '../../locales'),\n  modes: [\n    'query', // ?locale=zh-CN\n    function () {\n      return this.basePath === 'cn' ? 'zh-CN' : 'en';\n    },\n  ],\n}));\n\napp.use(koaViews(join(__dirname, '../../template'), {\n  extension: 'ejs'\n}));\n\napp.use(function *(next) {\n\n  const b = this.basePath;\n  const i18n = this.i18n;\n\n  const navigations = [\n    { href: `/${b}/faculty`, text: i18n.__('Faculty') },\n    { href: `/${b}/activity`, text: i18n.__('Activity') },\n    { href: `/${b}/competition`, text: i18n.__('Competition') },\n    { href: `/${b}/apply`, text: i18n.__('Apply') },\n    { href: `/${b}/cim`, text: i18n.__('CIM') },\n    { href: `/${b}/regulation`, text: i18n.__('Regulation') },\n    { href: `/${b}/contact`, text: i18n.__('Contact') },\n  ];\n\n  this.state = {\n    i18n: this.i18n,\n    basePath: this.basePath,\n    navigations,\n    CDN,\n  };\n\n  yield next;\n});\n\napp.use(function *(next) {\n  try {\n    yield next;\n  } catch (err) {\n    console.error(err.stack);\n    this.status = 500;\n  }\n});\n\napp.use(koaBodyparser());\napp.use(koaStatic(join(__dirname, '../../public')));\napp.use(koaStatic(join(__dirname, '../../source/client')));\n\napp.use(routes);\n\napp.listen(process.env.PORT || 10000, () => console.log('listen on 10000'));\n"]}