{"version":3,"sources":["../../source/server/routes.js"],"names":[],"mappings":";;;;;;;;;;;;;;;;;;;;;;;;AAKA,MAAM,aAAa,0BAAb;;AAEN,WAAW,GAAX,CAAe,GAAf,EAAoB,WAAW,IAAX,EAAiB;AACnC,QAAM,KAAK,MAAL,CAAY,OAAZ,EAAqB,EAArB,CAAN,CADmC;CAAjB,CAApB;;AAIA,WAAW,IAAX,CAAgB,cAAhB;;AAEA,MAAM,gBAAgB,0BAAhB;;AAEN,cAAc,GAAd,CAAkB,GAAlB,EAAuB,WAAW,IAAX,EAAiB;AACtC,QAAM,SAAS;AACb,eAAW,MAAX;GADI,CADgC;;AAKtC,QAAM,KAAK,MAAL,CAAY,CAAC,KAAD,GAAQ,KAAK,QAAL,EAAc,CAAlC,EAAqC,MAArC,CAAN,CALsC;CAAjB,CAAvB;;AAQA,cAAc,GAAd,CAAkB,UAAlB,EAA8B,aAAa;AACzC,QAAM,SAAS,MAAM,sBAAU,CAAC,GAAE,KAAK,QAAL,EAAc,WAAjB,CAAV,CAAN,CAD0B;AAEzC,SAAO,SAAP,GAAmB,SAAnB,CAFyC;AAGzC,QAAM,KAAK,MAAL,CAAY,SAAZ,EAAuB,MAAvB,CAAN,CAHyC;CAAb,CAA9B;;AAMA,cAAc,GAAd,CAAkB,QAAlB,EAA4B,WAAW,IAAX,EAAiB;AAC3C,QAAM,SAAS,MAAM,sBAAU,CAAC,GAAE,KAAK,QAAL,EAAc,CAAjB,GAAoB,KAAK,MAAL,CAAY,IAAZ,EAAiB,GAArC,CAAV,CAAN,CAD4B;;AAG3C,UAAQ,KAAK,MAAL,CAAY,IAAZ;AACR,SAAK,SAAL;AACE,aAAO,OAAP,GAAiB,OAAO,OAAP,CAAe,OAAf,CACf,oCADe,EAEf,CAAC,WAAD,GAAc,KAAK,GAAL,EAAS,iBAAvB,GAA0C,KAAK,GAAL,EAAS,iBAAnD,CAFe,CAAjB,CADF;AAIE,YAJF;AADA,SAMK,KAAL;AACE,aAAO,OAAP,GAAiB,OAAO,OAAP,CAAe,OAAf,CACf,oCADe,EAEf,CAAC,WAAD,GAAc,KAAK,GAAL,EAAS,YAAvB,GAAqC,KAAK,GAAL,EAAS,YAA9C,CAFe,CAAjB,CADF;AAIE,YAJF;AANA,GAH2C;;AAgB3C,SAAO,SAAP,GAAmB,KAAK,MAAL,CAAY,IAAZ,CAhBwB;;AAkB3C,QAAM,KAAK,MAAL,CAAY,SAAZ,EAAuB,MAAvB,CAAN,CAlB2C;CAAjB,CAA5B;;AAqBA,cAAc,GAAd,CAAkB,gBAAlB,EAAoC,WAAW,IAAX,EAAiB;AACnD,QAAM,SAAS,MAAM,sBAAU,CAAC,GAAE,KAAK,QAAL,EAAc,SAAjB,GAA4B,KAAK,MAAL,CAAY,IAAZ,EAAiB,GAA7C,CAAV,CAAN,CADoC;;AAGnD,SAAO,OAAP,GAAiB,OAAO,OAAP,CAAe,OAAf,CACf,sCADe,EAEf,CAAC,WAAD,GAAc,KAAK,GAAL,EAAS,iBAAvB,GAA0C,KAAK,GAAL,EAAS,iBAAnD,CAFe,CAAjB,CAHmD;;AAOnD,SAAO,SAAP,GAAmB,gBAAnB,CAPmD;;AASnD,QAAM,KAAK,MAAL,CAAY,SAAZ,EAAuB,MAAvB,CAAN,CATmD;CAAjB,CAApC;;AAYA,WAAW,GAAX,CAAe,UAAf,EAA2B,cAAc,MAAd,EAA3B;;kBAEe,WAAW,MAAX","file":"routes.js","sourcesContent":["import config from 'config';\nimport createRouter from 'koa-router';\nimport getLocals from './locals';\nimport submitForm from './routes/submit-form';\n\nconst rootRouter = createRouter();\n\nrootRouter.get('/', function *(next) {\n  yield this.render('index', {});\n});\n\nrootRouter.post('/submit-form', submitForm);\n\nconst contentRouter = createRouter();\n\ncontentRouter.get('/', function *(next) {\n  const locals = {\n    page_name: 'home',\n  };\n\n  yield this.render(`home-${this.basePath}`, locals);\n});\n\ncontentRouter.get('/contact', function *() {\n  const locals = yield getLocals(`${this.basePath}/contact.md`);\n  locals.page_name = 'contact';\n  yield this.render('contact', locals);\n});\n\ncontentRouter.get('/:page', function *(next) {\n  const locals = yield getLocals(`${this.basePath}/${this.params.page}.md`);\n\n  switch (this.params.page) {\n  case 'faculty':\n    locals.article = locals.article.replace(\n      /(<img) src=\"(\\/img\\/.+?)\\.(\\w+?)\"/g,\n      `$1 srcset=\"${this.CDN}$2-200-@1x.$3 1x,${this.CDN}$2-200-@2x.$3 2x\"`);\n    break;\n  case 'cim':\n    locals.article = locals.article.replace(\n      /(<img) src=\"(\\/img\\/.+?)\\.(\\w+?)\"/g,\n      `$1 srcset=\"${this.CDN}$2@1x.$3 1x,${this.CDN}$2@2x.$3 2x\"`);\n    break;\n  }\n\n  locals.page_name = this.params.page;\n\n  yield this.render('content', locals);\n});\n\ncontentRouter.get('/faculty/:name', function *(next) {\n  const locals = yield getLocals(`${this.basePath}/faculty/${this.params.name}.md`);\n\n  locals.article = locals.article.replace(\n    /(<img) src=\"(\\/img\\/.+?)\\.(\\w+?)(\")/g,\n    `$1 srcset=\"${this.CDN}$2-300-@1x.$3 1x,${this.CDN}$2-300-@2x.$3 2x\"`);\n\n  locals.page_name = 'faculty-detail';\n\n  yield this.render('content', locals);\n});\n\nrootRouter.use('/(cn|en)', contentRouter.routes());\n\nexport default rootRouter.routes();\n"]}