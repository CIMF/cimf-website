{"version":3,"sources":["../../source/server/routes.js"],"names":[],"mappings":";;;;;;AAAA;;;;AACA;;;;AACA;;;;AACA;;;;;;AAEA,MAAM,aAAa,0BAAnB;;AAEA,WAAW,GAAX,CAAe,GAAf,EAAoB,WAAW,IAAX,EAAiB;AACnC,QAAM,KAAK,MAAL,CAAY,OAAZ,EAAqB,EAArB,CAAN;AACD,CAFD;;AAIA,WAAW,IAAX,CAAgB,cAAhB;;AAEA,MAAM,gBAAgB,0BAAtB;;AAEA,cAAc,GAAd,CAAkB,GAAlB,EAAuB,WAAW,IAAX,EAAiB;AACtC,QAAM,SAAS;AACb,eAAW;AADE,GAAf;;AAIA,QAAM,KAAK,MAAL,CAAY,CAAC,KAAD,GAAQ,KAAK,QAAb,EAAsB,AAAtB,CAAZ,EAAqC,MAArC,CAAN;AACD,CAND;;AAQA,cAAc,GAAd,CAAkB,UAAlB,EAA8B,aAAa;AACzC,QAAM,SAAS,MAAM,sBAAU,CAAC,AAAD,GAAG,KAAK,QAAR,EAAiB,WAAjB,CAAV,CAArB;AACA,SAAO,SAAP,GAAmB,SAAnB;AACA,QAAM,KAAK,MAAL,CAAY,SAAZ,EAAuB,MAAvB,CAAN;AACD,CAJD;;AAMA,cAAc,GAAd,CAAkB,QAAlB,EAA4B,WAAW,IAAX,EAAiB;AAC3C,QAAM,SAAS,MAAM,sBAAU,CAAC,AAAD,GAAG,KAAK,QAAR,EAAiB,CAAjB,GAAoB,KAAK,MAAL,CAAY,IAAhC,EAAqC,GAArC,CAAV,CAArB;;AAEA,UAAQ,KAAK,MAAL,CAAY,IAApB;AACA,SAAK,SAAL;AACE,aAAO,OAAP,GAAiB,OAAO,OAAP,CAAe,OAAf,CACf,oCADe,EAEf,CAAC,WAAD,GAAc,KAAK,GAAnB,EAAuB,iBAAvB,GAA0C,KAAK,GAA/C,EAAmD,iBAAnD,CAFe,CAAjB;AAGA;AACF,SAAK,KAAL;AACE,aAAO,OAAP,GAAiB,OAAO,OAAP,CAAe,OAAf,CACf,oCADe,EAEf,CAAC,WAAD,GAAc,KAAK,GAAnB,EAAuB,YAAvB,GAAqC,KAAK,GAA1C,EAA8C,YAA9C,CAFe,CAAjB;AAGA;AAVF;;AAaA,SAAO,SAAP,GAAmB,KAAK,MAAL,CAAY,IAA/B;;AAEA,QAAM,KAAK,MAAL,CAAY,SAAZ,EAAuB,MAAvB,CAAN;AACD,CAnBD;;AAqBA,cAAc,GAAd,CAAkB,gBAAlB,EAAoC,WAAW,IAAX,EAAiB;AACnD,QAAM,SAAS,MAAM,sBAAU,CAAC,AAAD,GAAG,KAAK,QAAR,EAAiB,SAAjB,GAA4B,KAAK,MAAL,CAAY,IAAxC,EAA6C,GAA7C,CAAV,CAArB;;AAEA,SAAO,OAAP,GAAiB,OAAO,OAAP,CAAe,OAAf,CACf,sCADe,EAEf,CAAC,WAAD,GAAc,KAAK,GAAnB,EAAuB,iBAAvB,GAA0C,KAAK,GAA/C,EAAmD,iBAAnD,CAFe,CAAjB;;AAIA,SAAO,SAAP,GAAmB,gBAAnB;;AAEA,QAAM,KAAK,MAAL,CAAY,SAAZ,EAAuB,MAAvB,CAAN;AACD,CAVD;;AAYA,WAAW,GAAX,CAAe,UAAf,EAA2B,cAAc,MAAd,EAA3B;;kBAEe,WAAW,MAAX,E","file":"routes.js","sourcesContent":["import config from 'config';\nimport createRouter from 'koa-router';\nimport getLocals from './locals';\nimport submitForm from './routes/submit-form';\n\nconst rootRouter = createRouter();\n\nrootRouter.get('/', function *(next) {\n  yield this.render('index', {});\n});\n\nrootRouter.post('/submit-form', submitForm);\n\nconst contentRouter = createRouter();\n\ncontentRouter.get('/', function *(next) {\n  const locals = {\n    page_name: 'home',\n  };\n\n  yield this.render(`home-${this.basePath}`, locals);\n});\n\ncontentRouter.get('/contact', function *() {\n  const locals = yield getLocals(`${this.basePath}/contact.md`);\n  locals.page_name = 'contact';\n  yield this.render('contact', locals);\n});\n\ncontentRouter.get('/:page', function *(next) {\n  const locals = yield getLocals(`${this.basePath}/${this.params.page}.md`);\n\n  switch (this.params.page) {\n  case 'faculty':\n    locals.article = locals.article.replace(\n      /(<img) src=\"(\\/img\\/.+?)\\.(\\w+?)\"/g,\n      `$1 srcset=\"${this.CDN}$2-200-@1x.$3 1x,${this.CDN}$2-200-@2x.$3 2x\"`);\n    break;\n  case 'cim':\n    locals.article = locals.article.replace(\n      /(<img) src=\"(\\/img\\/.+?)\\.(\\w+?)\"/g,\n      `$1 srcset=\"${this.CDN}$2@1x.$3 1x,${this.CDN}$2@2x.$3 2x\"`);\n    break;\n  }\n\n  locals.page_name = this.params.page;\n\n  yield this.render('content', locals);\n});\n\ncontentRouter.get('/faculty/:name', function *(next) {\n  const locals = yield getLocals(`${this.basePath}/faculty/${this.params.name}.md`);\n\n  locals.article = locals.article.replace(\n    /(<img) src=\"(\\/img\\/.+?)\\.(\\w+?)(\")/g,\n    `$1 srcset=\"${this.CDN}$2-300-@1x.$3 1x,${this.CDN}$2-300-@2x.$3 2x\"`);\n\n  locals.page_name = 'faculty-detail';\n\n  yield this.render('content', locals);\n});\n\nrootRouter.use('/(cn|en)', contentRouter.routes());\n\nexport default rootRouter.routes();\n"]}